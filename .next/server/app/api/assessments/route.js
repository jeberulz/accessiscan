"use strict";(()=>{var e={};e.id=388,e.ids=[388,48],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},507:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>_,staticGenerationAsyncStorage:()=>d});var a={};t.r(a),t.d(a,{GET:()=>u,POST:()=>l,runtime:()=>c});var r=t(3278),i=t(5002),n=t(4877),o=t(1048);let c="nodejs";async function u(e){try{let{searchParams:s}=new URL(e.url),t=Math.min(parseInt(s.get("limit")||"10"),50),a=parseInt(s.get("offset")||"0"),r=s.get("website"),i=s.get("email"),n=s.get("minScore"),c=s.get("maxScore"),u=s.get("dateFrom"),l=s.get("dateTo"),p=s.get("impactLevel"),m=s.get("sortBy")||"date_desc",d=(0,o.getSupabaseServer)().from("assessments").select(`
        id,
        website_url,
        email,
        company_name,
        overall_score,
        total_issues,
        critical_issues,
        high_impact_issues,
        medium_impact_issues,
        low_impact_issues,
        screenshot_url,
        created_at,
        assessment_results
      `);if(r&&(d=d.ilike("website_url",`%${r}%`)),i&&(d=d.eq("email",i)),n&&(d=d.gte("overall_score",parseInt(n))),c&&(d=d.lte("overall_score",parseInt(c))),u&&(d=d.gte("created_at",new Date(u).toISOString())),l){let e=new Date(l);e.setDate(e.getDate()+1),d=d.lt("created_at",e.toISOString())}if(p)switch(p){case"high":d=d.gte("critical_issues",5);break;case"medium":d=d.gte("critical_issues",1).lte("critical_issues",4);break;case"low":d=d.eq("critical_issues",0)}switch(m){case"date_asc":d=d.order("created_at",{ascending:!0});break;case"score_desc":d=d.order("overall_score",{ascending:!1});break;case"score_asc":d=d.order("overall_score",{ascending:!0});break;case"issues_desc":d=d.order("total_issues",{ascending:!1});break;case"issues_asc":d=d.order("total_issues",{ascending:!0});break;default:d=d.order("created_at",{ascending:!1})}d=d.range(a,a+t-1);let{data:_,error:g,count:h}=await d;if(g)return console.error("Database error:",g),new Response(JSON.stringify({success:!1,message:"Failed to fetch assessments"}),{status:500,headers:{"content-type":"application/json"}});let S=_?.map(e=>({id:e.id,websiteUrl:e.website_url,overallScore:e.overall_score,totalIssues:e.total_issues,criticalIssues:e.critical_issues,highImpactIssues:e.high_impact_issues,mediumImpactIssues:e.medium_impact_issues,lowImpactIssues:e.low_impact_issues,issues:e.assessment_results?.issues||[],recommendations:["Review critical accessibility issues first","Implement systematic accessibility testing","Consider automated testing tools","Train development team on WCAG standards"],estimatedImpact:`${Math.round((100-e.overall_score)/100*20)}% of users may encounter barriers`,createdAt:e.created_at,aiDetailedResponse:e.assessment_results?.aiResponse||"",gradeRating:e.assessment_results?.gradeRating||"B-",pourScores:e.assessment_results?.pourScores||{perceivable:70,operable:70,understandable:70,robust:70},quickWins:e.assessment_results?.quickWins||[],screenshotUrl:e.screenshot_url,email:e.email,companyName:e.company_name}))||[];return new Response(JSON.stringify({success:!0,data:{assessments:S,pagination:{limit:t,offset:a,total:h||0,hasMore:a+t<(h||0)}}}),{headers:{"content-type":"application/json"}})}catch(e){return console.error("Assessments API error:",e),new Response(JSON.stringify({success:!1,message:"Internal server error"}),{status:500,headers:{"content-type":"application/json"}})}}async function l(e){try{let{id:s}=await e.json();if(!s)return new Response(JSON.stringify({success:!1,message:"Assessment ID is required"}),{status:400,headers:{"content-type":"application/json"}});let t=(0,o.getSupabaseServer)(),{data:a,error:r}=await t.from("assessments").select("*").eq("id",s).single();if(r||!a)return new Response(JSON.stringify({success:!1,message:"Assessment not found"}),{status:404,headers:{"content-type":"application/json"}});let i={id:a.id,websiteUrl:a.website_url,overallScore:a.overall_score,totalIssues:a.total_issues,criticalIssues:a.critical_issues,highImpactIssues:a.high_impact_issues,mediumImpactIssues:a.medium_impact_issues,lowImpactIssues:a.low_impact_issues,issues:a.assessment_results?.issues||[],recommendations:["Review critical accessibility issues first","Implement systematic accessibility testing","Consider automated testing tools","Train development team on WCAG standards"],estimatedImpact:`${Math.round((100-a.overall_score)/100*20)}% of users may encounter barriers`,createdAt:a.created_at,aiDetailedResponse:a.assessment_results?.aiResponse||"",gradeRating:a.assessment_results?.gradeRating||"B-",pourScores:a.assessment_results?.pourScores||{perceivable:70,operable:70,understandable:70,robust:70},quickWins:a.assessment_results?.quickWins||[],screenshotUrl:a.screenshot_url,email:a.email,companyName:a.company_name};return new Response(JSON.stringify({success:!0,data:i}),{headers:{"content-type":"application/json"}})}catch(e){return console.error("Single assessment API error:",e),new Response(JSON.stringify({success:!1,message:"Internal server error"}),{status:500,headers:{"content-type":"application/json"}})}}let p=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/assessments/route",pathname:"/api/assessments",filename:"route",bundlePath:"app/api/assessments/route"},resolvedPagePath:"/Users/jeberulz/Downloads/AccessiScan/src/app/api/assessments/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:d,serverHooks:_}=p,g="/api/assessments/route";function h(){return(0,n.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:d})}},3278:(e,s,t)=>{e.exports=t(517)},1048:(e,s,t)=>{t.d(s,{getSupabaseServer:()=>n});var a=t(8823);let r="https://nupfntmccpxrfnaaetmg.supabase.co",i=process.env.SUPABASE_SERVICE_ROLE_KEY;function n(){if(!r||!i)throw Error("Supabase environment variables are missing");return(0,a.eI)(r,i,{auth:{persistSession:!1,autoRefreshToken:!1},global:{headers:{"X-Client-Info":"accessiscan-next-server"}}})}r&&i||console.warn("Supabase env vars not set. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[379,823],()=>t(507));module.exports=a})();