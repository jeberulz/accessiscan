"use strict";(()=>{var e={};e.id=711,e.ids=[711],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},3554:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>d,patchFetch:()=>I,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u});var r={};t.r(r),t.d(r,{POST:()=>c,runtime:()=>n});var a=t(3278),i=t(5002),o=t(4877);let n="nodejs";async function c(e){try{let r;let{assessmentId:a,format:i,assessment:o}=await e.json();if(!i||!["pdf","csv"].includes(i))return new Response(JSON.stringify({success:!1,message:'Invalid export format. Use "pdf" or "csv"'}),{status:400,headers:{"content-type":"application/json"}});if(o)r=o;else{if(!a)return new Response(JSON.stringify({success:!1,message:"Either assessment data or assessmentId is required"}),{status:400,headers:{"content-type":"application/json"}});let{getSupabaseServer:e}=await Promise.all([t.e(823),t.e(48)]).then(t.bind(t,1048)),s=e(),{data:i,error:o}=await s.from("assessments").select("*").eq("id",a).single();if(o||!i)return new Response(JSON.stringify({success:!1,message:"Assessment not found"}),{status:404,headers:{"content-type":"application/json"}});r={id:i.id,websiteUrl:i.website_url,overallScore:i.overall_score,totalIssues:i.total_issues,criticalIssues:i.critical_issues,highImpactIssues:i.high_impact_issues,mediumImpactIssues:i.medium_impact_issues,lowImpactIssues:i.low_impact_issues,issues:i.assessment_results?.issues||[],recommendations:["Review critical accessibility issues first","Implement systematic accessibility testing","Consider automated testing tools","Train development team on WCAG standards"],estimatedImpact:`${Math.round((100-i.overall_score)/100*20)}% of users may encounter barriers`,createdAt:i.created_at,aiDetailedResponse:i.assessment_results?.aiResponse||"",gradeRating:i.assessment_results?.gradeRating||"B-",pourScores:i.assessment_results?.pourScores||{perceivable:70,operable:70,understandable:70,robust:70},quickWins:i.assessment_results?.quickWins||[],screenshotUrl:i.screenshot_url}}if("csv"===i){let e=function(e){let s="Website URL,Assessment Date,Overall Score,Grade,Total Issues,Critical Issues,High Impact Issues,Medium Impact Issues,Low Impact Issues,Issue Type,Issue Description,Impact Level,WCAG Level,Recommendation,Estimated User Impact\\n",t=[`"${e.websiteUrl}"`,`"${new Date(e.createdAt).toLocaleDateString()}"`,e.overallScore,`"${e.gradeRating}"`,e.totalIssues,e.criticalIssues,e.highImpactIssues,e.mediumImpactIssues,e.lowImpactIssues,'"SUMMARY"',`"Overall accessibility assessment for ${e.websiteUrl}"`,'"SUMMARY"','"WCAG 2.1 AA"','"See individual issues below"',`"${e.estimatedImpact}"`];return s+=t.join(",")+"\\n",e.issues.forEach(t=>{let r=[`"${e.websiteUrl}"`,`"${new Date(e.createdAt).toLocaleDateString()}"`,e.overallScore,`"${e.gradeRating}"`,e.totalIssues,e.criticalIssues,e.highImpactIssues,e.mediumImpactIssues,e.lowImpactIssues,`"${t.type}"`,`"${t.description.replace(/"/g,'""')}"`,`"${t.impact}"`,`"${t.wcagLevel}"`,`"${t.recommendation.replace(/"/g,'""')}"`,`"${e.estimatedImpact}"`];s+=r.join(",")+"\\n"}),s}(r),s=`accessibility-report-${r.websiteUrl.replace(/[^a-zA-Z0-9]/g,"-")}-${new Date().toISOString().split("T")[0]}.csv`;return new Response(e,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="${s}"`}})}if("pdf"===i){var s;let e=(s=r,{title:"Accessibility Assessment Report",subtitle:`${s.websiteUrl}`,date:new Date(s.createdAt).toLocaleDateString(),summary:{overallScore:s.overallScore,gradeRating:s.gradeRating,totalIssues:s.totalIssues,breakdown:{critical:s.criticalIssues,high:s.highImpactIssues,medium:s.mediumImpactIssues,low:s.lowImpactIssues}},pourScores:s.pourScores,issues:s.issues.map(e=>({type:e.type,description:e.description,impact:e.impact,wcagLevel:e.wcagLevel,recommendation:e.recommendation,element:e.element})),quickWins:s.quickWins,recommendations:s.recommendations,estimatedImpact:s.estimatedImpact,screenshotUrl:s.screenshotUrl});return new Response(JSON.stringify({success:!0,data:e,filename:`accessibility-report-${r.websiteUrl.replace(/[^a-zA-Z0-9]/g,"-")}-${new Date().toISOString().split("T")[0]}.pdf`}),{headers:{"content-type":"application/json"}})}}catch(e){return console.error("Export API error:",e),new Response(JSON.stringify({success:!1,message:"Export generation failed"}),{status:500,headers:{"content-type":"application/json"}})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/export/route",pathname:"/api/export",filename:"route",bundlePath:"app/api/export/route"},resolvedPagePath:"/Users/jeberulz/Downloads/AccessiScan/src/app/api/export/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:u,serverHooks:m}=p,d="/api/export/route";function I(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}},3278:(e,s,t)=>{e.exports=t(517)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[379],()=>t(3554));module.exports=r})();